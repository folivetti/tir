<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# language FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{-|
Module      : MachineLearning.Model.Fitness 
Description : TIR expression data structures
Copyright   : (c) Fabricio Olivetti de Franca, 2022
License     : GPL-3
Maintainer  : fabricio.olivetti@gmail.com
Stability   : experimental
Portability : POSIX

This module exports the functions that calculates the coefficients,
evaluate the fitness, penalty and constraints of a TIR expression.
-}</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MachineLearning.Model.Fitness</span><span> </span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#evalTrain"><span class="hs-identifier">evalTrain</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#evalTest"><span class="hs-identifier">evalTest</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#selectValidTerms"><span class="hs-identifier">selectValidTerms</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;\&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.ModalInterval</span></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Kaucher</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">inf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">width</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">singleton</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.ModalInterval</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span> </span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VS</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Model.Measure.html"><span class="hs-identifier">MachineLearning.Model.Measure</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier">Measure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html"><span class="hs-identifier">MachineLearning.Model.Regression</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier">nonlinearFit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier">evalPenalty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier">fitTask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier">predictTask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier">applyMeasures</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html"><span class="hs-identifier">MachineLearning.TIR</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier">TIR</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier">Individual</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier">Dataset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Constraint"><span class="hs-identifier">Constraint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#assembleTree"><span class="hs-identifier">assembleTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#replaceConsts"><span class="hs-identifier">replaceConsts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html"><span class="hs-identifier">MachineLearning.Utils.Config</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier">Task</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Penalty"><span class="hs-identifier">Penalty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.SRTree</span></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SRTree</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Function</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OptIntPow</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalTree</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalTreeMap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalFun</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">inverseFunc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">countNodes</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.SRTree.Print</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-comment">-- | removes invalid terms from the TIR expression. Invalid terms</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- are those that evaluate to `NaN` or `Infinite` within the</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- domains of each variable. The domains are either provided by</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- the configuration file or estimated using the training data.</span><span>
</span><span id="line-44"></span><span class="annot"><a href="MachineLearning.Model.Fitness.html#selectValidTerms"><span class="hs-identifier hs-type">selectValidTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Kaucher</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span>
</span><span id="line-45"></span><span id="selectValidTerms"><span class="annot"><span class="annottext">selectValidTerms :: TIR -&gt; Vector (Kaucher Double) -&gt; TIR
</span><a href="MachineLearning.Model.Fitness.html#selectValidTerms"><span class="hs-identifier hs-var hs-var">selectValidTerms</span></a></span></span><span> </span><span id="local-6989586621679075961"><span class="annot"><span class="annottext">tir :: TIR
</span><a href="#local-6989586621679075961"><span class="hs-identifier hs-var">tir</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679075959"><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075959"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679075958"><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075958"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075957"><span class="annot"><span class="annottext">Vector (Kaucher Double)
</span><a href="#local-6989586621679075957"><span class="hs-identifier hs-var">domains</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075961"><span class="hs-identifier hs-var">tir</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_p :: Sigma
</span><a href="MachineLearning.TIR.html#_p"><span class="hs-identifier hs-var">_p</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075955"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_q :: Sigma
</span><a href="MachineLearning.TIR.html#_q"><span class="hs-identifier hs-var">_q</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075953"><span class="hs-identifier hs-var">q'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>    </span><span id="local-6989586621679075955"><span class="annot"><span class="annottext">p' :: Sigma
</span><a href="#local-6989586621679075955"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sigma -&gt; Sigma
forall {a}.
[(a, Function, [(Int, Int)])] -&gt; [(a, Function, [(Int, Int)])]
</span><a href="#local-6989586621679075952"><span class="hs-identifier hs-var">selectValid</span></a></span><span> </span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075959"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621679075953"><span class="annot"><span class="annottext">q' :: Sigma
</span><a href="#local-6989586621679075953"><span class="hs-identifier hs-var hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sigma -&gt; Sigma
forall {a}.
[(a, Function, [(Int, Int)])] -&gt; [(a, Function, [(Int, Int)])]
</span><a href="#local-6989586621679075952"><span class="hs-identifier hs-var">selectValid</span></a></span><span> </span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075958"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621679075952"><span class="annot"><span class="annottext">selectValid :: [(a, Function, [(Int, Int)])] -&gt; [(a, Function, [(Int, Int)])]
</span><a href="#local-6989586621679075952"><span class="hs-identifier hs-var hs-var">selectValid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Function, [(Int, Int)]) -&gt; Bool)
-&gt; [(a, Function, [(Int, Int)])] -&gt; [(a, Function, [(Int, Int)])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075947"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075947"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075946"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075946"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Bool
</span><a href="MachineLearning.Model.Fitness.html#isValidInterval"><span class="hs-identifier hs-var">isValidInterval</span></a></span><span> </span><span class="annot"><span class="annottext">(Kaucher Double -&gt; Bool) -&gt; Kaucher Double -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Function -&gt; Kaucher Double -&gt; Kaucher Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075947"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Kaucher Double
</span><a href="#local-6989586621679075944"><span class="hs-identifier hs-var">evalPi</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075946"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621679075944"><span class="annot"><span class="annottext">evalPi :: [(Int, Int)] -&gt; Kaucher Double
</span><a href="#local-6989586621679075944"><span class="hs-identifier hs-var hs-var">evalPi</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Kaucher Double -&gt; Kaucher Double)
-&gt; Kaucher Double -&gt; [(Int, Int)] -&gt; Kaucher Double
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679075933"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075933"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075932"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075932"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075931"><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075931"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075931"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Kaucher Double -&gt; Kaucher Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector (Kaucher Double)
</span><a href="#local-6989586621679075957"><span class="hs-identifier hs-var">domains</span></a></span><span> </span><span class="annot"><span class="annottext">Vector (Kaucher Double) -&gt; Int -&gt; Kaucher Double
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075933"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Int -&gt; Kaucher Double
forall a. OptIntPow a =&gt; a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075932"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><span class="hs-number">1</span></span><span> </span><span>
</span><span id="line-52"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#selectValidTerms"><span class="hs-pragma hs-type">selectValidTerms</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span id="isValidInterval"><span class="annot"><span class="annottext">isValidInterval :: Kaucher Double -&gt; Bool
</span><a href="MachineLearning.Model.Fitness.html#isValidInterval"><span class="hs-identifier hs-var hs-var">isValidInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (Kaucher Double -&gt; Bool) -&gt; Kaucher Double -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Bool
</span><a href="MachineLearning.Model.Fitness.html#isInvalidInterval"><span class="hs-identifier hs-var">isInvalidInterval</span></a></span><span>
</span><span id="line-55"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#isValidInterval"><span class="hs-pragma hs-type">isValidInterval</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><a href="MachineLearning.Model.Fitness.html#isInvalidInterval"><span class="hs-identifier hs-type">isInvalidInterval</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kaucher</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                        </span><span>
</span><span id="line-58"></span><span id="isInvalidInterval"><span class="annot"><span class="annottext">isInvalidInterval :: Kaucher Double -&gt; Bool
</span><a href="MachineLearning.Model.Fitness.html#isInvalidInterval"><span class="hs-identifier hs-var hs-var">isInvalidInterval</span></a></span></span><span> </span><span id="local-6989586621679075925"><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075925"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Bool
forall a. Kaucher a -&gt; Bool
</span><span class="hs-identifier hs-var">Interval.isEmpty</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075925"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span>
</span><span id="line-59"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Bool
forall a. Kaucher a -&gt; Bool
</span><span class="hs-identifier hs-var">Interval.isInvalid</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075925"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-60"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075920"><span class="hs-identifier hs-var">ys1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isInfinite</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075919"><span class="hs-identifier hs-var">ys2</span></a></span><span> </span><span>
</span><span id="line-61"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075919"><span class="hs-identifier hs-var">ys2</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075920"><span class="hs-identifier hs-var">ys1</span></a></span><span> </span><span>
</span><span id="line-62"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075920"><span class="hs-identifier hs-var">ys1</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e50</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075919"><span class="hs-identifier hs-var">ys2</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e50</span></span><span>
</span><span id="line-63"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075920"><span class="hs-identifier hs-var">ys1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075919"><span class="hs-identifier hs-var">ys2</span></a></span><span>
</span><span id="line-64"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Double
forall a. Num a =&gt; Kaucher a -&gt; a
</span><span class="hs-identifier hs-var">width</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075925"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-8</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-66"></span><span>    </span><span id="local-6989586621679075920"><span class="annot"><span class="annottext">ys1 :: Double
</span><a href="#local-6989586621679075920"><span class="hs-identifier hs-var hs-var">ys1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Maybe Double -&gt; Double
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Double -&gt; Double) -&gt; Maybe Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Maybe Double
forall a. Kaucher a -&gt; Maybe a
</span><span class="hs-identifier hs-var">inf</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075925"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679075919"><span class="annot"><span class="annottext">ys2 :: Double
</span><a href="#local-6989586621679075919"><span class="hs-identifier hs-var hs-var">ys2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Maybe Double -&gt; Double
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Double -&gt; Double) -&gt; Maybe Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double -&gt; Maybe Double
forall a. Kaucher a -&gt; Maybe a
</span><span class="hs-identifier hs-var">sup</span></span><span> </span><span class="annot"><span class="annottext">Kaucher Double
</span><a href="#local-6989586621679075925"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-68"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#isInvalidInterval"><span class="hs-pragma hs-type">isInvalidInterval</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>            </span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | evaluates an individual first fitting the expression</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- with either OLS or a nonlinear optimization (not yet implemented) </span><span>
</span><span id="line-72"></span><span class="hs-comment">-- and calculating the fitness vector, constraints, penalty.</span><span>
</span><span id="line-73"></span><span class="annot"><a href="MachineLearning.Model.Fitness.html#evalTrain"><span class="hs-identifier hs-type">evalTrain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span>                          </span><span class="hs-comment">-- ^ Regression or Classification task</span><span>
</span><span id="line-74"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                          </span><span class="hs-comment">-- ^ if we are fitting the final best individual, in this case do not split the training data for validation</span><span>
</span><span id="line-75"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier hs-type">Measure</span></a></span><span class="hs-special">]</span><span>                     </span><span class="hs-comment">-- ^ list of performance measures to calculate</span><span>
</span><span id="line-76"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span>                    </span><span class="hs-comment">-- ^ constraint function</span><span>
</span><span id="line-77"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Penalty"><span class="hs-identifier hs-type">Penalty</span></a></span><span>                       </span><span class="hs-comment">-- ^ penalty</span><span>
</span><span id="line-78"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Kaucher</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ variable domains represented as a Kaucher Interval</span><span>
</span><span id="line-79"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                </span><span class="hs-comment">-- ^ training data</span><span>
</span><span id="line-80"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                 </span><span class="hs-comment">-- ^ training target</span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                </span><span class="hs-comment">-- ^ validation data</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>                 </span><span class="hs-comment">-- ^ validation target</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier hs-type">Individual</span></a></span><span> </span><span>
</span><span id="line-84"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier hs-type">Individual</span></a></span><span>
</span><span id="line-85"></span><span id="evalTrain"><span class="annot"><span class="annottext">evalTrain :: Task
-&gt; Bool
-&gt; [Measure]
-&gt; Constraint
-&gt; Penalty
-&gt; Vector (Kaucher Double)
-&gt; Dataset Double
-&gt; Vector Double
-&gt; Dataset Double
-&gt; Vector Double
-&gt; Individual
-&gt; Individual
</span><a href="MachineLearning.Model.Fitness.html#evalTrain"><span class="hs-identifier hs-var hs-var">evalTrain</span></a></span></span><span> </span><span id="local-6989586621679075907"><span class="annot"><span class="annottext">Task
</span><a href="#local-6989586621679075907"><span class="hs-identifier hs-var">task</span></a></span></span><span> </span><span id="local-6989586621679075906"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679075906"><span class="hs-identifier hs-var">isRefit</span></a></span></span><span> </span><span id="local-6989586621679075905"><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679075905"><span class="hs-identifier hs-var">measures</span></a></span></span><span> </span><span id="local-6989586621679075904"><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621679075904"><span class="hs-identifier hs-var">cnstrFun</span></a></span></span><span> </span><span id="local-6989586621679075903"><span class="annot"><span class="annottext">Penalty
</span><a href="#local-6989586621679075903"><span class="hs-identifier hs-var">penalty</span></a></span></span><span> </span><span id="local-6989586621679075902"><span class="annot"><span class="annottext">Vector (Kaucher Double)
</span><a href="#local-6989586621679075902"><span class="hs-identifier hs-var">domains</span></a></span></span><span> </span><span id="local-6989586621679075901"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075901"><span class="hs-identifier hs-var">xss_train</span></a></span></span><span> </span><span id="local-6989586621679075900"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075900"><span class="hs-identifier hs-var">ys_train</span></a></span></span><span> </span><span id="local-6989586621679075899"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075899"><span class="hs-identifier hs-var">xss_val</span></a></span></span><span> </span><span id="local-6989586621679075898"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075898"><span class="hs-identifier hs-var">ys_val</span></a></span></span><span> </span><span id="local-6989586621679075897"><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075897"><span class="hs-identifier hs-var">sol</span></a></span></span><span>
</span><span id="line-86"></span><span class="hs-comment">--  | LA.cols zss == 0                   = error &quot;found&quot;</span><span>
</span><span id="line-87"></span><span class="hs-comment">--  | (not.null) (LA.find (\x -&gt; isNaN x || isInfinite x) zss)  = error $ (show $ _chromo sol) &lt;&gt; show domains </span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679075906"><span class="hs-identifier hs-var">isRefit</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Individual -&gt; Bool) -&gt; Individual -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">[Double] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="annot"><span class="annottext">([Double] -&gt; Bool)
-&gt; (Individual -&gt; [Double]) -&gt; Individual -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">Individual -&gt; [Double]
</span><a href="MachineLearning.TIR.html#_fit"><span class="hs-identifier hs-var hs-var">_fit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075897"><span class="hs-identifier hs-var">sol</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075897"><span class="hs-identifier hs-var">sol</span></a></span><span>
</span><span id="line-89"></span><span class="hs-comment">--  | LA.cols zssP == 0                  = sol { _fit = [1/0] }</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075897"><span class="hs-identifier hs-var">sol</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_chromo :: TIR
</span><a href="MachineLearning.TIR.html#_chromo"><span class="hs-identifier hs-var">_chromo</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075892"><span class="hs-identifier hs-var">fitted</span></a></span><span>
</span><span id="line-91"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_fit :: [Double]
</span><a href="MachineLearning.TIR.html#_fit"><span class="hs-identifier hs-var">_fit</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679075891"><span class="hs-identifier hs-var">fitness</span></a></span><span>
</span><span id="line-92"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_weights :: [Vector Double]
</span><a href="MachineLearning.TIR.html#_weights"><span class="hs-identifier hs-var">_weights</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075889"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-93"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_constr :: Double
</span><a href="MachineLearning.TIR.html#_constr"><span class="hs-identifier hs-var">_constr</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075887"><span class="hs-identifier hs-var">cnst</span></a></span><span>
</span><span id="line-94"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_len :: Int
</span><a href="MachineLearning.TIR.html#_len"><span class="hs-identifier hs-var">_len</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075885"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-95"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_penalty :: Double
</span><a href="MachineLearning.TIR.html#_penalty"><span class="hs-identifier hs-var">_penalty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075883"><span class="hs-identifier hs-var">pnlty</span></a></span><span> </span><span>
</span><span id="line-96"></span><span>                                            </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- Fit the rational IT</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621679075882"><span class="annot"><span class="annottext">tir :: TIR
</span><a href="#local-6989586621679075882"><span class="hs-identifier hs-var hs-var">tir</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Vector (Kaucher Double) -&gt; TIR
</span><a href="MachineLearning.Model.Fitness.html#selectValidTerms"><span class="hs-identifier hs-var">selectValidTerms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Individual -&gt; TIR
</span><a href="MachineLearning.TIR.html#_chromo"><span class="hs-identifier hs-var hs-var">_chromo</span></a></span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075897"><span class="hs-identifier hs-var">sol</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector (Kaucher Double)
</span><a href="#local-6989586621679075902"><span class="hs-identifier hs-var">domains</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621679075889"><span class="annot"><span class="annottext">ws :: [Vector Double]
</span><a href="#local-6989586621679075889"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Task -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var">fitTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="#local-6989586621679075907"><span class="hs-identifier hs-var">task</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075882"><span class="hs-identifier hs-var">tir</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075901"><span class="hs-identifier hs-var">xss_train</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075900"><span class="hs-identifier hs-var">ys_train</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">-- Validate (it should be applied to every different weights set)</span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679075892"><span class="annot"><span class="annottext">fitted :: TIR
</span><a href="#local-6989586621679075892"><span class="hs-identifier hs-var hs-var">fitted</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Vector Double -&gt; TIR
</span><a href="MachineLearning.TIR.html#replaceConsts"><span class="hs-identifier hs-var">replaceConsts</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075882"><span class="hs-identifier hs-var">tir</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; TIR)
-&gt; ([Vector Double] -&gt; Vector Double) -&gt; [Vector Double] -&gt; TIR
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.tail</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; ([Vector Double] -&gt; Vector Double)
-&gt; [Vector Double]
-&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall (v :: * -&gt; *) a (w :: * -&gt; *).
(Vector v a, Vector w a) =&gt;
v a -&gt; w a
</span><span class="hs-identifier hs-var">VS.convert</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; ([Vector Double] -&gt; Vector Double)
-&gt; [Vector Double]
-&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span>
</span><span id="line-104"></span><span>                   </span><span class="annot"><span class="annottext">([Vector Double] -&gt; TIR) -&gt; [Vector Double] -&gt; TIR
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075889"><span class="hs-identifier hs-var">ws</span></a></span><span>               </span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679075891"><span class="annot"><span class="annottext">fitness :: [Double]
</span><a href="#local-6989586621679075891"><span class="hs-identifier hs-var hs-var">fitness</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Double) -&gt; [Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double
forall a. RealFloat a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Fitness.html#nan2inf"><span class="hs-identifier hs-var">nan2inf</span></a></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; [Double])
-&gt; (Individual -&gt; [Double]) -&gt; Individual -&gt; [Double]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe [Double] -&gt; [Double]
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [Double] -&gt; [Double])
-&gt; (Individual -&gt; Maybe [Double]) -&gt; Individual -&gt; [Double]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Task
-&gt; [Measure]
-&gt; Dataset Double
-&gt; Vector Double
-&gt; Individual
-&gt; Maybe [Double]
</span><a href="MachineLearning.Model.Fitness.html#evalTest"><span class="hs-identifier hs-var">evalTest</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="#local-6989586621679075907"><span class="hs-identifier hs-var">task</span></a></span><span> </span><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679075905"><span class="hs-identifier hs-var">measures</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075899"><span class="hs-identifier hs-var">xss_val</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075898"><span class="hs-identifier hs-var">ys_val</span></a></span><span>
</span><span id="line-106"></span><span>                   </span><span class="annot"><span class="annottext">(Individual -&gt; [Double]) -&gt; Individual -&gt; [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075897"><span class="hs-identifier hs-var">sol</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_chromo :: TIR
</span><a href="MachineLearning.TIR.html#_chromo"><span class="hs-identifier hs-var">_chromo</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075892"><span class="hs-identifier hs-var">fitted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_weights :: [Vector Double]
</span><a href="MachineLearning.TIR.html#_weights"><span class="hs-identifier hs-var">_weights</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075889"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- Length and constraint   </span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621679075868"><span class="annot"><span class="annottext">tree :: SRTree Int Double
</span><a href="#local-6989586621679075868"><span class="hs-identifier hs-var hs-var">tree</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; TIR -&gt; SRTree Int Double
</span><a href="MachineLearning.TIR.html#assembleTree"><span class="hs-identifier hs-var">assembleTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; Double
forall a. Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.head</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Double) -&gt; Vector Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall (v :: * -&gt; *) a (w :: * -&gt; *).
(Vector v a, Vector w a) =&gt;
v a -&gt; w a
</span><span class="hs-identifier hs-var">VS.convert</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075889"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075892"><span class="hs-identifier hs-var">fitted</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679075885"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679075885"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SRTree Int Double -&gt; Int
forall ix val. SRTree ix val -&gt; Int
</span><span class="hs-identifier hs-var">countNodes</span></span><span> </span><span class="annot"><span class="annottext">SRTree Int Double
</span><a href="#local-6989586621679075868"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679075887"><span class="annot"><span class="annottext">cnst :: Double
</span><a href="#local-6989586621679075887"><span class="hs-identifier hs-var hs-var">cnst</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraint
</span><a href="#local-6989586621679075904"><span class="hs-identifier hs-var">cnstrFun</span></a></span><span> </span><span class="annot"><span class="annottext">SRTree Int Double
</span><a href="#local-6989586621679075868"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679075883"><span class="annot"><span class="annottext">pnlty :: Double
</span><a href="#local-6989586621679075883"><span class="hs-identifier hs-var hs-var">pnlty</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Penalty -&gt; Int -&gt; Double -&gt; Double
</span><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var">evalPenalty</span></a></span><span> </span><span class="annot"><span class="annottext">Penalty
</span><a href="#local-6989586621679075903"><span class="hs-identifier hs-var">penalty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075885"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075887"><span class="hs-identifier hs-var">cnst</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Evaluates an expression into the test set. This is different from `fitnessReg` since</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- it doesn't apply OLS.</span><span>
</span><span id="line-116"></span><span class="annot"><a href="MachineLearning.Model.Fitness.html#evalTest"><span class="hs-identifier hs-type">evalTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier hs-type">Measure</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier hs-type">Individual</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span id="evalTest"><span class="annot"><span class="annottext">evalTest :: Task
-&gt; [Measure]
-&gt; Dataset Double
-&gt; Vector Double
-&gt; Individual
-&gt; Maybe [Double]
</span><a href="MachineLearning.Model.Fitness.html#evalTest"><span class="hs-identifier hs-var hs-var">evalTest</span></a></span></span><span> </span><span id="local-6989586621679075866"><span class="annot"><span class="annottext">Task
</span><a href="#local-6989586621679075866"><span class="hs-identifier hs-var">task</span></a></span></span><span> </span><span id="local-6989586621679075865"><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679075865"><span class="hs-identifier hs-var">measures</span></a></span></span><span> </span><span id="local-6989586621679075864"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075864"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span id="local-6989586621679075863"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075863"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679075862"><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075862"><span class="hs-identifier hs-var">sol</span></a></span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075861"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [Double]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Maybe [Double]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-120"></span><span>                 </span><span class="annot"><span class="annottext">([Double] -&gt; Maybe [Double]) -&gt; [Double] -&gt; Maybe [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Measure] -&gt; Vector Double -&gt; Vector Double -&gt; [Double]
</span><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier hs-var">applyMeasures</span></a></span><span> </span><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679075865"><span class="hs-identifier hs-var">measures</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075863"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-121"></span><span>                 </span><span class="annot"><span class="annottext">(Vector Double -&gt; [Double]) -&gt; Vector Double -&gt; [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Task -&gt; [Vector Double] -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="#local-6989586621679075866"><span class="hs-identifier hs-var">task</span></a></span><span>
</span><span id="line-122"></span><span>                 </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Vector Double)
-&gt; [Vector Double] -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; [Vector Double] -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dataset Double -&gt; Double -&gt; TIR -&gt; Vector Double
</span><a href="MachineLearning.Model.Fitness.html#evalTIR"><span class="hs-identifier hs-var">evalTIR</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075859"><span class="hs-identifier hs-var">xss'</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075858"><span class="hs-identifier hs-var">bias</span></a></span><span> </span><span class="annot"><span class="annottext">(TIR -&gt; Vector Double)
-&gt; (Vector Double -&gt; TIR) -&gt; Vector Double -&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Vector Double -&gt; TIR
</span><a href="MachineLearning.TIR.html#replaceConsts"><span class="hs-identifier hs-var">replaceConsts</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075857"><span class="hs-identifier hs-var">tir</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; TIR)
-&gt; (Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; TIR
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.tail</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall (v :: * -&gt; *) a (w :: * -&gt; *).
(Vector v a, Vector w a) =&gt;
v a -&gt; w a
</span><span class="hs-identifier hs-var">VS.convert</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075861"><span class="hs-identifier hs-var">weights</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679075857"><span class="annot"><span class="annottext">tir :: TIR
</span><a href="#local-6989586621679075857"><span class="hs-identifier hs-var hs-var">tir</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Individual -&gt; TIR
</span><a href="MachineLearning.TIR.html#_chromo"><span class="hs-identifier hs-var hs-var">_chromo</span></a></span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075862"><span class="hs-identifier hs-var">sol</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679075861"><span class="annot"><span class="annottext">weights :: [Vector Double]
</span><a href="#local-6989586621679075861"><span class="hs-identifier hs-var hs-var">weights</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Individual -&gt; [Vector Double]
</span><a href="MachineLearning.TIR.html#_weights"><span class="hs-identifier hs-var hs-var">_weights</span></a></span><span> </span><span class="annot"><span class="annottext">Individual
</span><a href="#local-6989586621679075862"><span class="hs-identifier hs-var">sol</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679075858"><span class="annot"><span class="annottext">bias :: Double
</span><a href="#local-6989586621679075858"><span class="hs-identifier hs-var hs-var">bias</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Double
forall a. Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.head</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Double) -&gt; Vector Double -&gt; Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall (v :: * -&gt; *) a (w :: * -&gt; *).
(Vector v a, Vector w a) =&gt;
v a -&gt; w a
</span><span class="hs-identifier hs-var">VS.convert</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075861"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="hs-comment">-- only works for regression</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">-- nSamples     = VS.length $ V.head xss</span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679075859"><span class="annot"><span class="annottext">xss' :: Dataset Double
</span><a href="#local-6989586621679075859"><span class="hs-identifier hs-var hs-var">xss'</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; Dataset Double
forall a. Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.tail</span></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075864"><span class="hs-identifier hs-var">xss</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">-- treeEval t   = fromJust $ runReader (evalTreeMap (VS.replicate nSamples) t) (xss' V.!?)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="annot"><a href="MachineLearning.Model.Fitness.html#evalTIR"><span class="hs-identifier hs-type">evalTIR</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LA.Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-132"></span><span id="evalTIR"><span class="annot"><span class="annottext">evalTIR :: Dataset Double -&gt; Double -&gt; TIR -&gt; Vector Double
</span><a href="MachineLearning.Model.Fitness.html#evalTIR"><span class="hs-identifier hs-var hs-var">evalTIR</span></a></span></span><span> </span><span id="local-6989586621679075853"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075853"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span id="local-6989586621679075852"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075852"><span class="hs-identifier hs-var">bias</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span id="local-6989586621679075851"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075851"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679075850"><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075850"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679075849"><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075849"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075851"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Vector Double
forall (c :: * -&gt; *) e. Container c e =&gt; e -&gt; c e
</span><span class="hs-identifier hs-var">LA.scalar</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075852"><span class="hs-identifier hs-var">bias</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075846"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075845"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679075846"><span class="annot"><span class="annottext">p' :: Vector Double
</span><a href="#local-6989586621679075846"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Double, Function, [(Int, Int)])
 -&gt; Vector Double -&gt; Vector Double)
-&gt; Vector Double -&gt; Sigma -&gt; Vector Double
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679075838"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075838"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075837"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075837"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075836"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075836"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075835"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075835"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Vector Double
forall (c :: * -&gt; *) e. Container c e =&gt; e -&gt; c e
</span><span class="hs-identifier hs-var">LA.scalar</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075838"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075837"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Vector Double
</span><a href="#local-6989586621679075834"><span class="hs-identifier hs-var">evalPi</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075836"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075835"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075850"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679075845"><span class="annot"><span class="annottext">q' :: Vector Double
</span><a href="#local-6989586621679075845"><span class="hs-identifier hs-var hs-var">q'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Double, Function, [(Int, Int)])
 -&gt; Vector Double -&gt; Vector Double)
-&gt; Vector Double -&gt; Sigma -&gt; Vector Double
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679075827"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075827"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075826"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075826"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075825"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075825"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075824"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075824"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Vector Double
forall (c :: * -&gt; *) e. Container c e =&gt; e -&gt; c e
</span><span class="hs-identifier hs-var">LA.scalar</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075827"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075826"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Vector Double
</span><a href="#local-6989586621679075834"><span class="hs-identifier hs-var">evalPi</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075825"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075824"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075849"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679075834"><span class="annot"><span class="annottext">evalPi :: [(Int, Int)] -&gt; Vector Double
</span><a href="#local-6989586621679075834"><span class="hs-identifier hs-var hs-var">evalPi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Vector Double -&gt; Vector Double)
-&gt; Vector Double -&gt; [(Int, Int)] -&gt; Vector Double
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679075815"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075815"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679075814"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075814"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075813"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075813"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075813"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075853"><span class="hs-identifier hs-var">xss</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; Int -&gt; Vector Double
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075815"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Vector Double -&gt; Int -&gt; Vector Double
forall a b. (Fractional a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^^</span></span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075814"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-137"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#evalTIR"><span class="hs-pragma hs-type">evalTIR</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-138"></span><span>    </span><span>
</span><span id="line-139"></span><span class="hs-comment">--instance OptIntPow (LA.Vector Double) where</span><span>
</span><span id="line-140"></span><span class="hs-comment">--  (^.) = (^^)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span id="local-6989586621679076038"><span class="annot"><a href="MachineLearning.Model.Fitness.html#nan2inf"><span class="hs-identifier hs-type">nan2inf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealFloat</span></span><span> </span><span class="annot"><a href="#local-6989586621679076038"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076038"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679076038"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-144"></span><span id="nan2inf"><span class="annot"><span class="annottext">nan2inf :: forall a. RealFloat a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Fitness.html#nan2inf"><span class="hs-identifier hs-var hs-var">nan2inf</span></a></span></span><span> </span><span id="local-6989586621679075798"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075798"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a -&gt; Bool
forall a. RealFloat a =&gt; a -&gt; Bool
</span><span class="hs-identifier hs-var">isNaN</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075798"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-145"></span><span>          </span><span class="hs-glyph">|</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075798"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-146"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Fitness.html#nan2inf"><span class="hs-pragma hs-type">nan2inf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-147"></span></pre></body></html>