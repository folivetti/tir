<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : MachineLearning.Model.Regression
Description : TIR expression data structures
Copyright   : (c) Fabricio Olivetti de Franca, 2022
License     : GPL-3
Maintainer  : fabricio.olivetti@gmail.com
Stability   : experimental
Portability : POSIX

Fitting functions for the coefficients.
-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MachineLearning.Model.Regression</span><span> </span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier">fitTask</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier">predictTask</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier">evalPenalty</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier">applyMeasures</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier">nonlinearFit</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">splitAt</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;\&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Matrix</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Numeric.GSL.Fitting</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nlFitting</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FittingMethod</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>               </span><span class="hs-keyword">hiding</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">splitAt</span></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">MachineLearning.Classification.Binary</span></span><span>     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BC</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">MachineLearning.Classification.OneVsAll</span></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OVA</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html"><span class="hs-identifier">MachineLearning.TIR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier">Individual</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html"><span class="hs-identifier">MachineLearning.Utils.Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier">Task</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Penalty"><span class="hs-identifier">Penalty</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Model.Measure.html"><span class="hs-identifier">MachineLearning.Model.Measure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier">Measure</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- * IT specific stuff</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- | Fits a linear model using l2-penalty</span><span>
</span><span id="line-38"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#ridge"><span class="hs-identifier hs-type">ridge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-39"></span><span id="ridge"><span class="annot"><span class="annottext">ridge :: Matrix Double -&gt; Vector Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#ridge"><span class="hs-identifier hs-var hs-var">ridge</span></a></span></span><span> </span><span id="local-6989586621679073858"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073858"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679073857"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073857"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073856"><span class="hs-identifier hs-var">oA</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall (c :: * -&gt; *) t.
(LSDiv c, Field t) =&gt;
Matrix t -&gt; c t -&gt; c t
</span><span class="hs-operator hs-var">&lt;\&gt;</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073855"><span class="hs-identifier hs-var">oB</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>   </span><span id="local-6989586621679073854"><span class="annot"><span class="annottext">mu :: Matrix Double
</span><a href="#local-6989586621679073854"><span class="hs-identifier hs-var hs-var">mu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><span class="hs-number">0.01</span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span>   </span><span id="local-6989586621679073853"><span class="annot"><span class="annottext">a' :: Matrix Double
</span><a href="#local-6989586621679073853"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073858"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-44"></span><span>   </span><span id="local-6989586621679073851"><span class="annot"><span class="annottext">b' :: Matrix Double
</span><a href="#local-6989586621679073851"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">(Matrix Double -&gt; Matrix Double) -&gt; Matrix Double -&gt; Matrix Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Matrix Double
forall a. Storable a =&gt; Vector a -&gt; Matrix a
</span><span class="hs-identifier hs-var">LA.asColumn</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073857"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-45"></span><span>   </span><span id="local-6989586621679073856"><span class="annot"><span class="annottext">oA :: Matrix Double
</span><a href="#local-6989586621679073856"><span class="hs-identifier hs-var hs-var">oA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073853"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073853"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073854"><span class="hs-identifier hs-var">mu</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Matrix Double
forall a. (Num a, Element a) =&gt; Int -&gt; Matrix a
</span><span class="hs-identifier hs-var">LA.ident</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.rows</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073853"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>   </span><span id="local-6989586621679073855"><span class="annot"><span class="annottext">oB :: Matrix Double
</span><a href="#local-6989586621679073855"><span class="hs-identifier hs-var hs-var">oB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073853"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073851"><span class="hs-identifier hs-var">b'</span></a></span><span>
</span><span id="line-47"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#ridge"><span class="hs-pragma hs-type">ridge</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Predicts a linear model</span><span>
</span><span id="line-50"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-type">predict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-51"></span><span id="predict"><span class="annot"><span class="annottext">predict :: Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var hs-var">predict</span></a></span></span><span> </span><span id="local-6989586621679073844"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073844"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679073843"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073843"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073844"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; IndexOf Vector
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073843"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073844"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
forall t. Numeric t =&gt; Matrix t -&gt; Vector t -&gt; Vector t
</span><span class="hs-operator hs-var">LA.#&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073843"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-52"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector Double
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Vector Double) -&gt; [Char] -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;predict: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; IndexOf Matrix
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073844"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; IndexOf Vector
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073843"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-pragma hs-type">predict</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | Solve the OLS *zss*w = ys*</span><span>
</span><span id="line-56"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-identifier hs-type">solveOLS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-57"></span><span id="solveOLS"><span class="annot"><span class="annottext">solveOLS :: Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-identifier hs-var hs-var">solveOLS</span></a></span></span><span> </span><span id="local-6989586621679073836"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073836"><span class="hs-identifier hs-var">zss</span></a></span></span><span> </span><span id="local-6989586621679073835"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073835"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073836"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
forall (c :: * -&gt; *) t.
(LSDiv c, Field t) =&gt;
Matrix t -&gt; c t -&gt; c t
</span><span class="hs-operator hs-var">&lt;\&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073835"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-58"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-pragma hs-type">solveOLS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Applies OLS and returns a Solution</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- if the expression is invalid, it returns Infinity as a fitness</span><span>
</span><span id="line-62"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-type">regress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-63"></span><span id="regress"><span class="annot"><span class="annottext">regress :: Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-var hs-var">regress</span></a></span></span><span> </span><span id="local-6989586621679073833"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073833"><span class="hs-identifier hs-var">zss</span></a></span></span><span> </span><span id="local-6989586621679073832"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073832"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-identifier hs-var">solveOLS</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073833"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073832"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-pragma hs-type">regress</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | Applies conjugate gradient for binary classification</span><span>
</span><span id="line-67"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#classify"><span class="hs-identifier hs-type">classify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span id="classify"><span class="annot"><span class="annottext">classify :: Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classify"><span class="hs-identifier hs-var hs-var">classify</span></a></span></span><span> </span><span id="local-6989586621679073830"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073830"><span class="hs-identifier hs-var">zss</span></a></span></span><span> </span><span id="local-6989586621679073829"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073829"><span class="hs-identifier hs-var">ys</span></a></span></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073828"><span class="annot"><span class="annottext">ws0 :: Vector Double
</span><a href="#local-6989586621679073828"><span class="hs-identifier hs-var hs-var">ws0</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Vector Double
forall e d (c :: * -&gt; *). Konst e d c =&gt; e -&gt; d -&gt; c e
</span><span class="hs-identifier hs-var">LA.konst</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073830"><span class="hs-identifier hs-var">zss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679073826"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073826"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MinimizeMethod
-&gt; Double
-&gt; Int
-&gt; Regularization
-&gt; Matrix Double
-&gt; Vector Double
-&gt; Vector Double
-&gt; (Vector Double, Matrix Double)
</span><span class="hs-identifier hs-var">BC.learn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; MinimizeMethod
</span><span class="hs-identifier hs-var">BC.ConjugateGradientPR</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0001</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span> </span><span class="annot"><span class="annottext">Regularization
</span><span class="hs-identifier hs-var">BC.RegNone</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073830"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073829"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073828"><span class="hs-identifier hs-var">ws0</span></a></span><span>
</span><span id="line-71"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073826"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-comment">-- | Applies conjugate gradient for one-vs-all classification</span><span>
</span><span id="line-74"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#classifyMult"><span class="hs-identifier hs-type">classifyMult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-75"></span><span id="classifyMult"><span class="annot"><span class="annottext">classifyMult :: Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classifyMult"><span class="hs-identifier hs-var hs-var">classifyMult</span></a></span></span><span> </span><span id="local-6989586621679073821"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073821"><span class="hs-identifier hs-var">zss</span></a></span></span><span> </span><span id="local-6989586621679073820"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073820"><span class="hs-identifier hs-var">ys</span></a></span></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679073819"><span class="annot"><span class="annottext">ws0 :: [Vector Double]
</span><a href="#local-6989586621679073819"><span class="hs-identifier hs-var hs-var">ws0</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double -&gt; [Vector Double]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073817"><span class="hs-identifier hs-var">numLabels</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; [Vector Double])
-&gt; Vector Double -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Vector Double
forall e d (c :: * -&gt; *). Konst e d c =&gt; e -&gt; d -&gt; c e
</span><span class="hs-identifier hs-var">LA.konst</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073821"><span class="hs-identifier hs-var">zss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>          </span><span id="local-6989586621679073817"><span class="annot"><span class="annottext">numLabels :: Int
</span><a href="#local-6989586621679073817"><span class="hs-identifier hs-var hs-var">numLabels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; Int) -&gt; [Double] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; [Double]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; [Double]) -&gt; [Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; [Double]
forall a. Storable a =&gt; Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">LA.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073820"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-78"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679073814"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073814"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Matrix Double]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MinimizeMethod
-&gt; Double
-&gt; Int
-&gt; Regularization
-&gt; Int
-&gt; Matrix Double
-&gt; Vector Double
-&gt; [Vector Double]
-&gt; ([Vector Double], [Matrix Double])
</span><span class="hs-identifier hs-var">OVA.learn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; MinimizeMethod
</span><span class="hs-identifier hs-var">OVA.ConjugateGradientPR</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0001</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span> </span><span class="annot"><span class="annottext">Regularization
</span><span class="hs-identifier hs-var">OVA.RegNone</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073817"><span class="hs-identifier hs-var">numLabels</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073821"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073820"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073819"><span class="hs-identifier hs-var">ws0</span></a></span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073814"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-comment">-- | chooses the appropriate fitting function</span><span>
</span><span id="line-83"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-type">fitTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-84"></span><span id="fitTask"><span class="annot"><span class="annottext">fitTask :: Task -&gt; Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var hs-var">fitTask</span></a></span></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#Regression"><span class="hs-identifier hs-var">Regression</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-var">regress</span></a></span><span>
</span><span id="line-85"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var">fitTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#Classification"><span class="hs-identifier hs-var">Classification</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classify"><span class="hs-identifier hs-var">classify</span></a></span><span>
</span><span id="line-86"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var">fitTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#ClassMult"><span class="hs-identifier hs-var">ClassMult</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classifyMult"><span class="hs-identifier hs-var">classifyMult</span></a></span><span>
</span><span id="line-87"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-pragma hs-type">fitTask</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | sigmoid function for classification.</span><span>
</span><span id="line-90"></span><span id="local-6989586621679073809"><span class="annot"><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-type">sigmoid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679073809"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679073809"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679073809"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-91"></span><span id="sigmoid"><span class="annot"><span class="annottext">sigmoid :: a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var hs-var">sigmoid</span></a></span></span><span> </span><span id="local-6989586621679073807"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073807"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">a -&gt; a
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073807"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-pragma hs-type">sigmoid</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | chooses the appropriate prediction function</span><span>
</span><span id="line-95"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-type">predictTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-96"></span><span id="predictTask"><span class="annot"><span class="annottext">predictTask :: Task -&gt; [Vector Double] -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var hs-var">predictTask</span></a></span></span><span> </span><span class="annot"><span class="annottext">Task
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector Double
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;predictTask: empty coefficients matrix&quot;</span></span><span>
</span><span id="line-97"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#Regression"><span class="hs-identifier hs-var">Regression</span></a></span><span> </span><span id="local-6989586621679073804"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073804"><span class="hs-identifier hs-var">yss</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073804"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-98"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#Classification"><span class="hs-identifier hs-var">Classification</span></a></span><span> </span><span id="local-6989586621679073802"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073802"><span class="hs-identifier hs-var">yss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073802"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-99"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#ClassMult"><span class="hs-identifier hs-var">ClassMult</span></a></span><span> </span><span id="local-6989586621679073801"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073801"><span class="hs-identifier hs-var">yss</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Vector Double
</span><span class="hs-identifier hs-var">LA.vector</span></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; Vector Double) -&gt; [Double] -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Double) -&gt; [Vector Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double)
-&gt; (Vector Double -&gt; Int) -&gt; Vector Double -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Int
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.maxIndex</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; [Double]) -&gt; [Vector Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toRows</span></span><span> </span><span class="annot"><span class="annottext">(Matrix Double -&gt; [Vector Double])
-&gt; Matrix Double -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; [Vector Double] -&gt; Matrix Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; [Vector Double] -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073801"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-100"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-pragma hs-type">predictTask</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | evals the penalty function</span><span>
</span><span id="line-103"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-type">evalPenalty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Penalty"><span class="hs-identifier hs-type">Penalty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-104"></span><span id="evalPenalty"><span class="annot"><span class="annottext">evalPenalty :: Penalty -&gt; Int -&gt; Double -&gt; Double
</span><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var hs-var">evalPenalty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Penalty
</span><a href="MachineLearning.Utils.Config.html#NoPenalty"><span class="hs-identifier hs-var">NoPenalty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span>
</span><span id="line-105"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var">evalPenalty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Len"><span class="hs-identifier hs-type">Len</span></a></span><span> </span><span id="local-6989586621679073793"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073793"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621679073792"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073792"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073792"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073793"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-106"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var">evalPenalty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span id="local-6989586621679073790"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073790"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621679073789"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073789"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073789"><span class="hs-identifier hs-var">val</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073790"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-107"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-pragma hs-type">evalPenalty</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | applies a list of performance measures</span><span>
</span><span id="line-110"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier hs-type">applyMeasures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier hs-type">Measure</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span id="applyMeasures"><span class="annot"><span class="annottext">applyMeasures :: [Measure] -&gt; Vector Double -&gt; Vector Double -&gt; [Double]
</span><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier hs-var hs-var">applyMeasures</span></a></span></span><span> </span><span id="local-6989586621679073788"><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679073788"><span class="hs-identifier hs-var">measures</span></a></span></span><span> </span><span id="local-6989586621679073787"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073787"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679073786"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073786"><span class="hs-identifier hs-var">ysHat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Measure -&gt; Double) -&gt; [Measure] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double -&gt; Double)
-&gt; (Vector Double, Vector Double) -&gt; Double
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-operator hs-var">`uncurry`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073787"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073786"><span class="hs-identifier hs-var">ysHat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Vector Double -&gt; Vector Double -&gt; Double) -&gt; Double)
-&gt; (Measure -&gt; Vector Double -&gt; Vector Double -&gt; Double)
-&gt; Measure
-&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Measure -&gt; Vector Double -&gt; Vector Double -&gt; Double
</span><a href="MachineLearning.Model.Measure.html#_fun"><span class="hs-identifier hs-var hs-var">_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679073788"><span class="hs-identifier hs-var">measures</span></a></span><span>
</span><span id="line-112"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-pragma hs-type">applyMeasures</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Non-linear optimization using Levenberg-Marquardt method.</span><span>
</span><span id="line-115"></span><span id="local-6989586621679073783"><span class="annot"><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-type">nonlinearFit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679073783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679073783"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-116"></span><span id="nonlinearFit"><span class="annot"><span class="annottext">nonlinearFit :: Vector Double
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; m (Vector Double)
</span><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-var hs-var">nonlinearFit</span></a></span></span><span> </span><span id="local-6989586621679073782"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073782"><span class="hs-identifier hs-var">ys_train</span></a></span></span><span> </span><span id="local-6989586621679073781"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073781"><span class="hs-identifier hs-var">zssP</span></a></span></span><span> </span><span id="local-6989586621679073780"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073780"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; m (Vector Double)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; m (Vector Double))
-&gt; (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; m (Vector Double)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double, Matrix Double) -&gt; Vector Double
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Vector Double, Matrix Double) -&gt; Vector Double)
-&gt; (Vector Double -&gt; (Vector Double, Matrix Double))
-&gt; Vector Double
-&gt; Vector Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FittingMethod
-&gt; Double
-&gt; Double
-&gt; Int
-&gt; (Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Matrix Double)
-&gt; Vector Double
-&gt; (Vector Double, Matrix Double)
</span><span class="hs-identifier hs-var">nlFitting</span></span><span> </span><span class="annot"><span class="annottext">FittingMethod
</span><span class="hs-identifier hs-var">LevenbergMarquardtScaled</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-9</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-9</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679073778"><span class="hs-identifier hs-var">model'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Matrix Double
</span><a href="#local-6989586621679073777"><span class="hs-identifier hs-var">jacob'</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679073778"><span class="annot"><span class="annottext">model' :: Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679073778"><span class="hs-identifier hs-var hs-var">model'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double
-&gt; Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#model"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073782"><span class="hs-identifier hs-var">ys_train</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073781"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073780"><span class="hs-identifier hs-var">zssQ</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679073777"><span class="annot"><span class="annottext">jacob' :: Vector Double -&gt; Matrix Double
</span><a href="#local-6989586621679073777"><span class="hs-identifier hs-var hs-var">jacob'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#jacob"><span class="hs-identifier hs-var">jacob</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073781"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073780"><span class="hs-identifier hs-var">zssQ</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span class="hs-comment">-- | calculates the error given the parameter vector beta</span><span>
</span><span id="line-122"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#model"><span class="hs-identifier hs-type">model</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-123"></span><span id="model"><span class="annot"><span class="annottext">model :: Vector Double
-&gt; Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#model"><span class="hs-identifier hs-var hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679073774"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073774"><span class="hs-identifier hs-var">ys_train</span></a></span></span><span> </span><span id="local-6989586621679073773"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073773"><span class="hs-identifier hs-var">zssP</span></a></span></span><span> </span><span id="local-6989586621679073772"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073772"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span> </span><span id="local-6989586621679073771"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073771"><span class="hs-identifier hs-var">beta</span></a></span></span><span> </span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073772"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073770"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073774"><span class="hs-identifier hs-var">ys_train</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073769"><span class="hs-identifier hs-var">ysHat</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073774"><span class="hs-identifier hs-var">ys_train</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679073768"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073768"><span class="hs-identifier hs-var">betaP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073767"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073767"><span class="hs-identifier hs-var">betaQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double -&gt; (Vector Double, Vector Double)
forall a. Storable a =&gt; Int -&gt; Vector a -&gt; (Vector a, Vector a)
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073773"><span class="hs-identifier hs-var">zssP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073771"><span class="hs-identifier hs-var">beta</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679073770"><span class="annot"><span class="annottext">ysHat_P :: Vector Double
</span><a href="#local-6989586621679073770"><span class="hs-identifier hs-var hs-var">ysHat_P</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073773"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073768"><span class="hs-identifier hs-var">betaP</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679073766"><span class="annot"><span class="annottext">ysHat_Q :: Vector Double
</span><a href="#local-6989586621679073766"><span class="hs-identifier hs-var hs-var">ysHat_Q</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073772"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073772"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073767"><span class="hs-identifier hs-var">betaQ</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679073769"><span class="annot"><span class="annottext">ysHat :: Vector Double
</span><a href="#local-6989586621679073769"><span class="hs-identifier hs-var hs-var">ysHat</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073770"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073766"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | calculates the Jacobian given the parameter vector beta. Doesn't support</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- the outer transformation function.</span><span>
</span><span id="line-134"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#jacob"><span class="hs-identifier hs-type">jacob</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-135"></span><span id="jacob"><span class="annot"><span class="annottext">jacob :: Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#jacob"><span class="hs-identifier hs-var hs-var">jacob</span></a></span></span><span> </span><span id="local-6989586621679073765"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073765"><span class="hs-identifier hs-var">zssP</span></a></span></span><span> </span><span id="local-6989586621679073764"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073764"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span> </span><span id="local-6989586621679073763"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073763"><span class="hs-identifier hs-var">beta</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073764"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073765"><span class="hs-identifier hs-var">zssP</span></a></span><span>
</span><span id="line-136"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; [Vector Double] -&gt; Matrix Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073762"><span class="hs-identifier hs-var">pjac</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; [Vector Double] -&gt; [Vector Double]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679073761"><span class="hs-identifier hs-var">qjac</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679073760"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073760"><span class="hs-identifier hs-var">betaP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073759"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073759"><span class="hs-identifier hs-var">betaQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double -&gt; (Vector Double, Vector Double)
forall a. Storable a =&gt; Int -&gt; Vector a -&gt; (Vector a, Vector a)
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073765"><span class="hs-identifier hs-var">zssP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073763"><span class="hs-identifier hs-var">beta</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679073758"><span class="annot"><span class="annottext">ysHat_P :: Vector Double
</span><a href="#local-6989586621679073758"><span class="hs-identifier hs-var hs-var">ysHat_P</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073765"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073760"><span class="hs-identifier hs-var">betaP</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679073757"><span class="annot"><span class="annottext">ysHat_Q :: Vector Double
</span><a href="#local-6989586621679073757"><span class="hs-identifier hs-var hs-var">ysHat_Q</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073764"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073759"><span class="hs-identifier hs-var">betaQ</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679073756"><span class="annot"><span class="annottext">ysHat :: Vector Double
</span><a href="#local-6989586621679073756"><span class="hs-identifier hs-var hs-var">ysHat</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073758"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073757"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679073762"><span class="annot"><span class="annottext">pjac :: [Vector Double]
</span><a href="#local-6989586621679073762"><span class="hs-identifier hs-var hs-var">pjac</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073755"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073757"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679073755"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073755"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toColumns</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073765"><span class="hs-identifier hs-var">zssP</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679073761"><span class="annot"><span class="annottext">qjac :: [Vector Double]
</span><a href="#local-6989586621679073761"><span class="hs-identifier hs-var hs-var">qjac</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073753"><span class="hs-identifier hs-var">c</span></a></span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073758"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073757"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span class="annot"><span class="annottext">Vector Double -&gt; Integer -&gt; Vector Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679073753"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679073753"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toColumns</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679073764"><span class="hs-identifier hs-var">zssQ</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-144"></span><span>    </span><span>
</span><span id="line-145"></span><span class="hs-comment">{-
toEv :: SRTree Int Double -&gt; (V.Vector Double -&gt; Double)
toEv (Var !ix) = (`V.unsafeIndex` ix)
toEv (Const !val) = const val
toEv (Add !l !r) = jn (+) (toEv l) (toEv r)
toEv (Mul !l !r) = jn (*) (toEv l) (toEv r)
toEv (Fun Exp !t) = exp . toEv t
{-# INLINE toEv #-}

jn :: (Double -&gt; Double -&gt; Double) -&gt; (V.Vector Double -&gt; Double) -&gt; (V.Vector Double -&gt; Double) -&gt; (V.Vector Double -&gt; Double)
jn op f g = \x -&gt; op (f x) (g x)
{-# INLINE jn #-}
-}</span><span>
</span><span id="line-158"></span></pre></body></html>