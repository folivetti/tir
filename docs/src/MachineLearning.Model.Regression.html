<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : MachineLearning.Model.Regression
Description : TIR expression data structures
Copyright   : (c) Fabricio Olivetti de Franca, 2022
License     : GPL-3
Maintainer  : fabricio.olivetti@gmail.com
Stability   : experimental
Portability : POSIX

Fitting functions for the coefficients.
-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MachineLearning.Model.Regression</span><span> </span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier">fitTask</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier">predictTask</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier">evalPenalty</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier">applyMeasures</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier">nonlinearFit</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier">tirToMatrix</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.SRTree</span></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evalFun</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Function</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OptIntPow</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalFun</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">inverseFunc</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html"><span class="hs-identifier">MachineLearning.TIR</span></a></span><span>       </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier">TIR</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier">Individual</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier">Dataset</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Constraint"><span class="hs-identifier">Constraint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#assembleTree"><span class="hs-identifier">assembleTree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#replaceConsts"><span class="hs-identifier">replaceConsts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span>  </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VS</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(!)</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nub</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Vector</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">splitAt</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;\&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Matrix</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Numeric.GSL.Fitting</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nlFitting</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FittingMethod</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>               </span><span class="hs-keyword">hiding</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">splitAt</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html"><span class="hs-identifier">MachineLearning.TIR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#Individual"><span class="hs-identifier">Individual</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html"><span class="hs-identifier">MachineLearning.Utils.Config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier">Task</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Penalty"><span class="hs-identifier">Penalty</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="MachineLearning.Model.Measure.html"><span class="hs-identifier">MachineLearning.Model.Measure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier">Measure</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- * IT specific stuff</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#createQ"><span class="hs-identifier hs-type">createQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LA.Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LA.Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-42"></span><span id="createQ"><span class="annot"><span class="annottext">createQ :: Vector Double -&gt; Matrix Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#createQ"><span class="hs-identifier hs-var hs-var">createQ</span></a></span></span><span> </span><span id="local-6989586621679075589"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075589"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; (Matrix Double -&gt; [Vector Double])
-&gt; Matrix Double
-&gt; Matrix Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; [Vector Double] -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075589"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; [Vector Double])
-&gt; (Matrix Double -&gt; [Vector Double])
-&gt; Matrix Double
-&gt; [Vector Double]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toColumns</span></span><span>
</span><span id="line-43"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#createQ"><span class="hs-pragma hs-type">createQ</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#avg"><span class="hs-identifier hs-type">avg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-46"></span><span id="avg"><span class="annot"><span class="annottext">avg :: Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#avg"><span class="hs-identifier hs-var hs-var">avg</span></a></span></span><span> </span><span id="local-6989586621679075583"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075583"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Vector Double
forall a. Storable a =&gt; [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">LA.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double -&gt; Double
forall (c :: * -&gt; *) e. Container c e =&gt; c e -&gt; e
</span><span class="hs-identifier hs-var">LA.sumElements</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075583"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; IndexOf Vector
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075583"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-47"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#avg"><span class="hs-pragma hs-type">avg</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | transform a data matrix using a TIR expression. This function returns</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- a tuple with the transformed data of the numerator and denominator, respectivelly.</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- Each column of the transformed data represents one term of the TIR expression.</span><span>
</span><span id="line-52"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier hs-type">tirToMatrix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LA.Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LA.Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span id="tirToMatrix"><span class="annot"><span class="annottext">tirToMatrix :: Dataset Double -&gt; TIR -&gt; (Matrix Double, Matrix Double)
</span><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier hs-var hs-var">tirToMatrix</span></a></span></span><span> </span><span id="local-6989586621679075578"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075578"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679075576"><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075576"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679075575"><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075575"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; ([Vector Double] -&gt; Matrix Double)
-&gt; ([Vector Double], [Vector Double])
-&gt; (Matrix Double, Matrix Double)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; ([Vector Double] -&gt; [Vector Double])
-&gt; [Vector Double]
-&gt; Matrix Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075573"><span class="hs-identifier hs-var">bias</span></a></span><span class="annot"><span class="annottext">Vector Double -&gt; [Vector Double] -&gt; [Vector Double]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075572"><span class="hs-identifier hs-var">p'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075571"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621679075573"><span class="annot"><span class="annottext">bias :: Vector Double
</span><a href="#local-6989586621679075573"><span class="hs-identifier hs-var hs-var">bias</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; Vector Double
forall a. Vector a -&gt; a
</span><span class="hs-identifier hs-var">V.head</span></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075578"><span class="hs-identifier hs-var">xss</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span id="local-6989586621679075569"><span class="annot"><span class="annottext">xss' :: Dataset Double
</span><a href="#local-6989586621679075569"><span class="hs-identifier hs-var hs-var">xss'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; Dataset Double
forall a. Vector a -&gt; Vector a
</span><span class="hs-identifier hs-var">V.tail</span></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075578"><span class="hs-identifier hs-var">xss</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621679075566"><span class="annot"><span class="annottext">sigma2mtx :: [(a, Function, [(Int, Int)])] -&gt; [Vector Double]
</span><a href="#local-6989586621679075566"><span class="hs-identifier hs-var hs-var">sigma2mtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Function, [(Int, Int)]) -&gt; Vector Double)
-&gt; [(a, Function, [(Int, Int)])] -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075565"><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075565"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075564"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075564"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="annot"><span class="annottext">Function
</span><a href="#local-6989586621679075565"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Vector Double
</span><a href="#local-6989586621679075563"><span class="hs-identifier hs-var">evalPi</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679075564"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621679075563"><span class="annot"><span class="annottext">evalPi :: [(Int, Int)] -&gt; Vector Double
</span><a href="#local-6989586621679075563"><span class="hs-identifier hs-var hs-var">evalPi</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; Vector Double -&gt; Vector Double)
-&gt; Vector Double -&gt; [(Int, Int)] -&gt; Vector Double
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679075552"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075552"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075551"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075551"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075550"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075550"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075550"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075569"><span class="hs-identifier hs-var">xss'</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; Int -&gt; Vector Double
forall a. Vector a -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075552"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Int -&gt; Vector Double
forall a b. (Fractional a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^^</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075551"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621679075572"><span class="annot"><span class="annottext">p' :: [Vector Double]
</span><a href="#local-6989586621679075572"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sigma -&gt; [Vector Double]
forall {a}. [(a, Function, [(Int, Int)])] -&gt; [Vector Double]
</span><a href="#local-6989586621679075566"><span class="hs-identifier hs-var">sigma2mtx</span></a></span><span> </span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075576"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span id="local-6989586621679075571"><span class="annot"><span class="annottext">q' :: [Vector Double]
</span><a href="#local-6989586621679075571"><span class="hs-identifier hs-var hs-var">q'</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sigma -&gt; [Vector Double]
forall {a}. [(a, Function, [(Int, Int)])] -&gt; [Vector Double]
</span><a href="#local-6989586621679075566"><span class="hs-identifier hs-var">sigma2mtx</span></a></span><span> </span><span class="annot"><span class="annottext">Sigma
</span><a href="#local-6989586621679075575"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-61"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-pragma hs-type">tirToMatrix</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- | Fits a linear model using l2-penalty</span><span>
</span><span id="line-64"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#ridge"><span class="hs-identifier hs-type">ridge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-65"></span><span id="ridge"><span class="annot"><span class="annottext">ridge :: Matrix Double -&gt; Vector Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#ridge"><span class="hs-identifier hs-var hs-var">ridge</span></a></span></span><span> </span><span id="local-6989586621679075547"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075547"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679075546"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075546"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075545"><span class="hs-identifier hs-var">oA</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall (c :: * -&gt; *) t.
(LSDiv c, Field t) =&gt;
Matrix t -&gt; c t -&gt; c t
</span><span class="hs-operator hs-var">&lt;\&gt;</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075544"><span class="hs-identifier hs-var">oB</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>   </span><span id="local-6989586621679075538"><span class="annot"><span class="annottext">mu :: Matrix Double
</span><a href="#local-6989586621679075538"><span class="hs-identifier hs-var hs-var">mu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><span class="hs-number">0.01</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span>   </span><span id="local-6989586621679075532"><span class="annot"><span class="annottext">a' :: Matrix Double
</span><a href="#local-6989586621679075532"><span class="hs-identifier hs-var hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075547"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-70"></span><span>   </span><span id="local-6989586621679075526"><span class="annot"><span class="annottext">b' :: Matrix Double
</span><a href="#local-6989586621679075526"><span class="hs-identifier hs-var hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">(Matrix Double -&gt; Matrix Double) -&gt; Matrix Double -&gt; Matrix Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Matrix Double
forall a. Storable a =&gt; Vector a -&gt; Matrix a
</span><span class="hs-identifier hs-var">LA.asColumn</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075546"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-71"></span><span>   </span><span id="local-6989586621679075545"><span class="annot"><span class="annottext">oA :: Matrix Double
</span><a href="#local-6989586621679075545"><span class="hs-identifier hs-var hs-var">oA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075532"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075532"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075538"><span class="hs-identifier hs-var">mu</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Matrix Double
forall a. (Num a, Element a) =&gt; Int -&gt; Matrix a
</span><span class="hs-identifier hs-var">LA.ident</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.rows</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075532"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>   </span><span id="local-6989586621679075544"><span class="annot"><span class="annottext">oB :: Matrix Double
</span><a href="#local-6989586621679075544"><span class="hs-identifier hs-var hs-var">oB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075532"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall m mt. Transposable m mt =&gt; m -&gt; mt
</span><span class="hs-identifier hs-var">LA.tr</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075526"><span class="hs-identifier hs-var">b'</span></a></span><span>
</span><span id="line-73"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#ridge"><span class="hs-pragma hs-type">ridge</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">-- | Predicts a linear model</span><span>
</span><span id="line-76"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-type">predict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-77"></span><span id="predict"><span class="annot"><span class="annottext">predict :: Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var hs-var">predict</span></a></span></span><span> </span><span id="local-6989586621679075495"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075495"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679075494"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075494"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075495"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; IndexOf Vector
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075494"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075495"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
forall t. Numeric t =&gt; Matrix t -&gt; Vector t -&gt; Vector t
</span><span class="hs-operator hs-var">LA.#&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075494"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-78"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector Double
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Vector Double) -&gt; [Char] -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;predict: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; IndexOf Matrix
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075495"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double -&gt; IndexOf Vector
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.size</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075494"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-pragma hs-type">predict</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">-- | Solve the OLS *zss*w = ys*</span><span>
</span><span id="line-82"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-identifier hs-type">solveOLS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-83"></span><span id="solveOLS"><span class="annot"><span class="annottext">solveOLS :: Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-identifier hs-var hs-var">solveOLS</span></a></span></span><span> </span><span id="local-6989586621679075488"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075488"><span class="hs-identifier hs-var">zss</span></a></span></span><span> </span><span id="local-6989586621679075487"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075487"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075488"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
forall (c :: * -&gt; *) t.
(LSDiv c, Field t) =&gt;
Matrix t -&gt; c t -&gt; c t
</span><span class="hs-operator hs-var">&lt;\&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075487"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-84"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-pragma hs-type">solveOLS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- | Applies OLS and returns a Solution</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- if the expression is invalid, it returns Infinity as a fitness</span><span>
</span><span id="line-88"></span><span class="hs-comment">--regress :: Matrix Double -&gt; Vector Double -&gt; [Vector Double]</span><span>
</span><span id="line-89"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-type">regress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span id="regress"><span class="annot"><span class="annottext">regress :: TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-var hs-var">regress</span></a></span></span><span> </span><span id="local-6989586621679075485"><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075485"><span class="hs-identifier hs-var">tir</span></a></span></span><span> </span><span id="local-6989586621679075484"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075484"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span id="local-6989586621679075483"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075483"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075482"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075481"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075481"><span class="hs-identifier hs-var">zssP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075480"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075480"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; TIR -&gt; (Matrix Double, Matrix Double)
</span><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier hs-var">tirToMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075484"><span class="hs-identifier hs-var">xss</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075485"><span class="hs-identifier hs-var">tir</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679075478"><span class="annot"><span class="annottext">ys' :: Vector Double
</span><a href="#local-6989586621679075478"><span class="hs-identifier hs-var hs-var">ys'</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Function -&gt; Function
</span><span class="hs-identifier hs-var">inverseFunc</span></span><span> </span><span class="annot"><span class="annottext">(Function -&gt; Function) -&gt; Function -&gt; Function
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Function
</span><a href="MachineLearning.TIR.html#_funY"><span class="hs-identifier hs-var hs-var">_funY</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075485"><span class="hs-identifier hs-var">tir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075483"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621679075476"><span class="annot"><span class="annottext">zssQy :: Matrix Double
</span><a href="#local-6989586621679075476"><span class="hs-identifier hs-var hs-var">zssQy</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Matrix Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#createQ"><span class="hs-identifier hs-var">createQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075478"><span class="hs-identifier hs-var">ys'</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075480"><span class="hs-identifier hs-var">zssQ</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679075465"><span class="annot"><span class="annottext">zss :: Matrix Double
</span><a href="#local-6989586621679075465"><span class="hs-identifier hs-var hs-var">zss</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075480"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-96"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075481"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double -&gt; Matrix Double
forall t. Element t =&gt; Matrix t -&gt; Matrix t -&gt; Matrix t
</span><span class="hs-operator hs-var">LA.|||</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Matrix Double
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075476"><span class="hs-identifier hs-var">zssQy</span></a></span><span> </span><span>
</span><span id="line-97"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075481"><span class="hs-identifier hs-var">zssP</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679075482"><span class="annot"><span class="annottext">ws :: Vector Double
</span><a href="#local-6989586621679075482"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075465"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-99"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#avg"><span class="hs-identifier hs-var">avg</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075478"><span class="hs-identifier hs-var">ys'</span></a></span><span>
</span><span id="line-100"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#solveOLS"><span class="hs-identifier hs-var">solveOLS</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075465"><span class="hs-identifier hs-var">zss</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075478"><span class="hs-identifier hs-var">ys'</span></a></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- regress zss ys = [solveOLS zss ys]</span><span>
</span><span id="line-102"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-pragma hs-type">regress</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Applies conjugate gradient for binary classification</span><span>
</span><span id="line-105"></span><span class="hs-comment">--classify :: Matrix Double -&gt; Vector Double -&gt; [Vector Double]</span><span>
</span><span id="line-106"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#classify"><span class="hs-identifier hs-type">classify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span id="classify"><span class="annot"><span class="annottext">classify :: Int -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classify"><span class="hs-identifier hs-var hs-var">classify</span></a></span></span><span> </span><span id="local-6989586621679075460"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075460"><span class="hs-identifier hs-var">niter</span></a></span></span><span> </span><span id="local-6989586621679075459"><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075459"><span class="hs-identifier hs-var">tir</span></a></span></span><span> </span><span id="local-6989586621679075458"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075458"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span id="local-6989586621679075457"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075457"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075456"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679075456"><span class="annot"><span class="annottext">ws :: Vector Double
</span><a href="#local-6989586621679075456"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; (Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-var">nonlinearFit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075460"><span class="hs-identifier hs-var">niter</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075453"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075452"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075457"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#dsigmoid"><span class="hs-identifier hs-var">dsigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075449"><span class="hs-identifier hs-var">theta0</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679075449"><span class="annot"><span class="annottext">theta0 :: Vector Double
</span><a href="#local-6989586621679075449"><span class="hs-identifier hs-var hs-var">theta0</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Vector Double
forall e d (c :: * -&gt; *). Konst e d c =&gt; e -&gt; d -&gt; c e
</span><span class="hs-identifier hs-var">LA.konst</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075453"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075452"><span class="hs-identifier hs-var">zssQ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075453"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075453"><span class="hs-identifier hs-var">zssP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075452"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075452"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; TIR -&gt; (Matrix Double, Matrix Double)
</span><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier hs-var">tirToMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075458"><span class="hs-identifier hs-var">xss</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075459"><span class="hs-identifier hs-var">tir</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | Applies conjugate gradient for one-vs-all classification</span><span>
</span><span id="line-114"></span><span class="hs-comment">--classifyMult :: Matrix Double -&gt; Vector Double -&gt; [Vector Double]</span><span>
</span><span id="line-115"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#classifyMult"><span class="hs-identifier hs-type">classifyMult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span id="classifyMult"><span class="annot"><span class="annottext">classifyMult :: Int -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classifyMult"><span class="hs-identifier hs-var hs-var">classifyMult</span></a></span></span><span> </span><span id="local-6989586621679075441"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075441"><span class="hs-identifier hs-var">niter</span></a></span></span><span> </span><span id="local-6989586621679075440"><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075440"><span class="hs-identifier hs-var">tir</span></a></span></span><span> </span><span id="local-6989586621679075439"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075439"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span id="local-6989586621679075438"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075438"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double -&gt; Vector Double)
-&gt; [Vector Double] -&gt; [Vector Double] -&gt; [Vector Double]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075436"><span class="hs-identifier hs-var">minimize</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075435"><span class="hs-identifier hs-var">yss</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075434"><span class="hs-identifier hs-var">theta0</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679075430"><span class="annot"><span class="annottext">numLabels :: Int
</span><a href="#local-6989586621679075430"><span class="hs-identifier hs-var hs-var">numLabels</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; Int) -&gt; [Double] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; [Double]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nub</span></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; [Double]) -&gt; [Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; [Double]
forall a. Storable a =&gt; Vector a -&gt; [a]
</span><span class="hs-identifier hs-var">LA.toList</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075438"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621679075435"><span class="annot"><span class="annottext">yss :: [Vector Double]
</span><a href="#local-6989586621679075435"><span class="hs-identifier hs-var hs-var">yss</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Vector Double) -&gt; [Int] -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double
forall {b} {a}. (Storable b, Integral a, Num b) =&gt; a -&gt; Vector b
</span><a href="#local-6989586621679075419"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075430"><span class="hs-identifier hs-var">numLabels</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621679075436"><span class="annot"><span class="annottext">minimize :: Vector Double -&gt; Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075436"><span class="hs-identifier hs-var hs-var">minimize</span></a></span></span><span> </span><span id="local-6989586621679075416"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075416"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679075415"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075415"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; (Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-var">nonlinearFit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075441"><span class="hs-identifier hs-var">niter</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075414"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075413"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075416"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#dsigmoid"><span class="hs-identifier hs-var">dsigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075415"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679075434"><span class="annot"><span class="annottext">theta0 :: [Vector Double]
</span><a href="#local-6989586621679075434"><span class="hs-identifier hs-var hs-var">theta0</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double -&gt; [Vector Double]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075430"><span class="hs-identifier hs-var">numLabels</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; [Vector Double])
-&gt; Vector Double -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Int -&gt; Vector Double
forall e d (c :: * -&gt; *). Konst e d c =&gt; e -&gt; d -&gt; c e
</span><span class="hs-identifier hs-var">LA.konst</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075414"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075413"><span class="hs-identifier hs-var">zssQ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075414"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075414"><span class="hs-identifier hs-var">zssP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075413"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075413"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; TIR -&gt; (Matrix Double, Matrix Double)
</span><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier hs-var">tirToMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075439"><span class="hs-identifier hs-var">xss</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075440"><span class="hs-identifier hs-var">tir</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679075419"><span class="annot"><span class="annottext">f :: a -&gt; Vector b
</span><a href="#local-6989586621679075419"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679075390"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075390"><span class="hs-identifier hs-var">sample</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Double -&gt; b) -&gt; Vector Double -&gt; Vector b
forall a b.
(Storable a, Storable b) =&gt;
(a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">VS.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679075388"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075388"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double -&gt; a
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075388"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075390"><span class="hs-identifier hs-var">sample</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075438"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | chooses the appropriate fitting function</span><span>
</span><span id="line-127"></span><span class="hs-comment">--fitTask :: Task -&gt; Matrix Double -&gt; Vector Double -&gt; [Vector Double]</span><span>
</span><span id="line-128"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-type">fitTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-129"></span><span id="fitTask"><span class="annot"><span class="annottext">fitTask :: Task -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var hs-var">fitTask</span></a></span></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#Regression"><span class="hs-identifier hs-var">Regression</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-var">regress</span></a></span><span>
</span><span id="line-130"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var">fitTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#RegressionNL"><span class="hs-identifier hs-type">RegressionNL</span></a></span><span> </span><span id="local-6989586621679075384"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075384"><span class="hs-identifier hs-var">niter</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regressNL"><span class="hs-identifier hs-var">regressNL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075384"><span class="hs-identifier hs-var">niter</span></a></span><span>
</span><span id="line-131"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var">fitTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Classification"><span class="hs-identifier hs-type">Classification</span></a></span><span> </span><span id="local-6989586621679075381"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075381"><span class="hs-identifier hs-var">niter</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classify"><span class="hs-identifier hs-var">classify</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075381"><span class="hs-identifier hs-var">niter</span></a></span><span>
</span><span id="line-132"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-identifier hs-var">fitTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#ClassMult"><span class="hs-identifier hs-type">ClassMult</span></a></span><span> </span><span id="local-6989586621679075379"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075379"><span class="hs-identifier hs-var">niter</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#classifyMult"><span class="hs-identifier hs-var">classifyMult</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075379"><span class="hs-identifier hs-var">niter</span></a></span><span>
</span><span id="line-133"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#fitTask"><span class="hs-pragma hs-type">fitTask</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | sigmoid function for classification.</span><span>
</span><span id="line-136"></span><span id="local-6989586621679075718"><span class="annot"><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-type">sigmoid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679075718"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075718"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075718"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-137"></span><span id="sigmoid"><span class="annot"><span class="annottext">sigmoid :: forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var hs-var">sigmoid</span></a></span></span><span> </span><span id="local-6989586621679075367"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075367"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">a -&gt; a
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075367"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-pragma hs-type">sigmoid</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">-- | derivative sigmoid function for classification.</span><span>
</span><span id="line-141"></span><span id="local-6989586621679075365"><span class="annot"><a href="MachineLearning.Model.Regression.html#dsigmoid"><span class="hs-identifier hs-type">dsigmoid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679075365"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075365"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075365"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-142"></span><span id="dsigmoid"><span class="annot"><span class="annottext">dsigmoid :: forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#dsigmoid"><span class="hs-identifier hs-var hs-var">dsigmoid</span></a></span></span><span> </span><span id="local-6989586621679075356"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075356"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075356"><span class="hs-identifier hs-var">z</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679075356"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#dsigmoid"><span class="hs-pragma hs-type">dsigmoid</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- | chooses the appropriate prediction function</span><span>
</span><span id="line-146"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-type">predictTask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Task"><span class="hs-identifier hs-type">Task</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-147"></span><span id="predictTask"><span class="annot"><span class="annottext">predictTask :: Task -&gt; [Vector Double] -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var hs-var">predictTask</span></a></span></span><span> </span><span class="annot"><span class="annottext">Task
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Vector Double
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;predictTask: empty coefficients matrix&quot;</span></span><span>
</span><span id="line-148"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="annot"><span class="annottext">Task
</span><a href="MachineLearning.Utils.Config.html#Regression"><span class="hs-identifier hs-var">Regression</span></a></span><span> </span><span id="local-6989586621679075355"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075355"><span class="hs-identifier hs-var">yss</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075355"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-149"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#RegressionNL"><span class="hs-identifier hs-type">RegressionNL</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075353"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075353"><span class="hs-identifier hs-var">yss</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075353"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-150"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Classification"><span class="hs-identifier hs-type">Classification</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075352"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075352"><span class="hs-identifier hs-var">yss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075352"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-151"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-identifier hs-var">predictTask</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#ClassMult"><span class="hs-identifier hs-type">ClassMult</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679075351"><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075351"><span class="hs-identifier hs-var">yss</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Vector Double
</span><span class="hs-identifier hs-var">LA.vector</span></span><span> </span><span class="annot"><span class="annottext">([Double] -&gt; Vector Double) -&gt; [Double] -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Double) -&gt; [Vector Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double)
-&gt; (Vector Double -&gt; Int) -&gt; Vector Double -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Int
forall (c :: * -&gt; *) t. Container c t =&gt; c t -&gt; IndexOf c
</span><span class="hs-identifier hs-var">LA.maxIndex</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; [Double]) -&gt; [Vector Double] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toRows</span></span><span> </span><span class="annot"><span class="annottext">(Matrix Double -&gt; [Vector Double])
-&gt; Matrix Double -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; [Vector Double] -&gt; Matrix Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; [Vector Double] -&gt; [Vector Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
forall a. Floating a =&gt; a -&gt; a
</span><a href="MachineLearning.Model.Regression.html#sigmoid"><span class="hs-identifier hs-var">sigmoid</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075351"><span class="hs-identifier hs-var">yss</span></a></span><span>
</span><span id="line-152"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#predictTask"><span class="hs-pragma hs-type">predictTask</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | evals the penalty function</span><span>
</span><span id="line-155"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-type">evalPenalty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="MachineLearning.Utils.Config.html#Penalty"><span class="hs-identifier hs-type">Penalty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-156"></span><span id="evalPenalty"><span class="annot"><span class="annottext">evalPenalty :: Penalty -&gt; Int -&gt; Double -&gt; Double
</span><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var hs-var">evalPenalty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Penalty
</span><a href="MachineLearning.Utils.Config.html#NoPenalty"><span class="hs-identifier hs-var">NoPenalty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span>
</span><span id="line-157"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var">evalPenalty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Len"><span class="hs-identifier hs-type">Len</span></a></span><span> </span><span id="local-6989586621679075345"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075345"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621679075344"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075344"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075344"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075345"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-158"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-identifier hs-var">evalPenalty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="MachineLearning.Utils.Config.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span id="local-6989586621679075342"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075342"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621679075341"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075341"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075341"><span class="hs-identifier hs-var">val</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679075342"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-159"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#evalPenalty"><span class="hs-pragma hs-type">evalPenalty</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | applies a list of performance measures</span><span>
</span><span id="line-162"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier hs-type">applyMeasures</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="MachineLearning.Model.Measure.html#Measure"><span class="hs-identifier hs-type">Measure</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span id="applyMeasures"><span class="annot"><span class="annottext">applyMeasures :: [Measure] -&gt; Vector Double -&gt; Vector Double -&gt; [Double]
</span><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-identifier hs-var hs-var">applyMeasures</span></a></span></span><span> </span><span id="local-6989586621679075340"><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679075340"><span class="hs-identifier hs-var">measures</span></a></span></span><span> </span><span id="local-6989586621679075339"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075339"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679075338"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075338"><span class="hs-identifier hs-var">ysHat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Measure -&gt; Double) -&gt; [Measure] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double -&gt; Double)
-&gt; (Vector Double, Vector Double) -&gt; Double
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-operator hs-var">`uncurry`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075339"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075338"><span class="hs-identifier hs-var">ysHat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Vector Double -&gt; Vector Double -&gt; Double) -&gt; Double)
-&gt; (Measure -&gt; Vector Double -&gt; Vector Double -&gt; Double)
-&gt; Measure
-&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Measure -&gt; Vector Double -&gt; Vector Double -&gt; Double
</span><a href="MachineLearning.Model.Measure.html#_fun"><span class="hs-identifier hs-var hs-var">_fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Measure]
</span><a href="#local-6989586621679075340"><span class="hs-identifier hs-var">measures</span></a></span><span>
</span><span id="line-164"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#applyMeasures"><span class="hs-pragma hs-type">applyMeasures</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#regressNL"><span class="hs-identifier hs-type">regressNL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#TIR"><span class="hs-identifier hs-type">TIR</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="MachineLearning.TIR.html#Dataset"><span class="hs-identifier hs-type">Dataset</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span id="regressNL"><span class="annot"><span class="annottext">regressNL :: Int -&gt; TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regressNL"><span class="hs-identifier hs-var hs-var">regressNL</span></a></span></span><span> </span><span id="local-6989586621679075335"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075335"><span class="hs-identifier hs-var">niter</span></a></span></span><span> </span><span id="local-6989586621679075334"><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075334"><span class="hs-identifier hs-var">tir</span></a></span></span><span> </span><span id="local-6989586621679075333"><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075333"><span class="hs-identifier hs-var">xss</span></a></span></span><span> </span><span id="local-6989586621679075332"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075332"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075331"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679075331"><span class="annot"><span class="annottext">ws :: Vector Double
</span><a href="#local-6989586621679075331"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; (Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-var">nonlinearFit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075335"><span class="hs-identifier hs-var">niter</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075330"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075329"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075332"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075328"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075327"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075326"><span class="hs-identifier hs-var">theta0</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621679075328"><span class="annot"><span class="annottext">f :: Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075328"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. Floating val =&gt; Function -&gt; val -&gt; val
</span><span class="hs-identifier hs-var">evalFun</span></span><span> </span><span class="annot"><span class="annottext">(Function -&gt; Vector Double -&gt; Vector Double)
-&gt; Function -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Function
</span><a href="MachineLearning.TIR.html#_funY"><span class="hs-identifier hs-var hs-var">_funY</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075334"><span class="hs-identifier hs-var">tir</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621679075327"><span class="annot"><span class="annottext">f' :: Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075327"><span class="hs-identifier hs-var hs-var">f'</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Function -&gt; Vector Double -&gt; Vector Double
forall val. (Eq val, Floating val) =&gt; Function -&gt; val -&gt; val
</span><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">(Function -&gt; Vector Double -&gt; Vector Double)
-&gt; Function -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Function
</span><a href="MachineLearning.TIR.html#_funY"><span class="hs-identifier hs-var hs-var">_funY</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075334"><span class="hs-identifier hs-var">tir</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679075326"><span class="annot"><span class="annottext">theta0 :: Vector Double
</span><a href="#local-6989586621679075326"><span class="hs-identifier hs-var hs-var">theta0</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Vector Double
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Vector Double)
-&gt; [Vector Double] -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TIR -&gt; Dataset Double -&gt; Vector Double -&gt; [Vector Double]
</span><a href="MachineLearning.Model.Regression.html#regress"><span class="hs-identifier hs-var">regress</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075334"><span class="hs-identifier hs-var">tir</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075333"><span class="hs-identifier hs-var">xss</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075332"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075330"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075330"><span class="hs-identifier hs-var">zssP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075329"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075329"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dataset Double -&gt; TIR -&gt; (Matrix Double, Matrix Double)
</span><a href="MachineLearning.Model.Regression.html#tirToMatrix"><span class="hs-identifier hs-var">tirToMatrix</span></a></span><span> </span><span class="annot"><span class="annottext">Dataset Double
</span><a href="#local-6989586621679075333"><span class="hs-identifier hs-var">xss</span></a></span><span> </span><span class="annot"><span class="annottext">TIR
</span><a href="#local-6989586621679075334"><span class="hs-identifier hs-var">tir</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- | Non-linear optimization using Levenberg-Marquardt method.</span><span>
</span><span id="line-176"></span><span class="hs-comment">--nonlinearFit :: Monad m =&gt; Vector Double -&gt; Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; m (Vector Double)</span><span>
</span><span id="line-177"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-type">nonlinearFit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-178"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-179"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-180"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-181"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-182"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-183"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span>
</span><span id="line-184"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-185"></span><span id="nonlinearFit"><span class="annot"><span class="annottext">nonlinearFit :: Int
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; (Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#nonlinearFit"><span class="hs-identifier hs-var hs-var">nonlinearFit</span></a></span></span><span> </span><span id="local-6989586621679075319"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075319"><span class="hs-identifier hs-var">niter</span></a></span></span><span> </span><span id="local-6989586621679075318"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075318"><span class="hs-identifier hs-var">zssP</span></a></span></span><span> </span><span id="local-6989586621679075317"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075317"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span> </span><span id="local-6989586621679075316"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075316"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679075315"><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075315"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679075314"><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075314"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span id="local-6989586621679075313"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075313"><span class="hs-identifier hs-var">theta0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector Double, Matrix Double) -&gt; Vector Double
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Vector Double, Matrix Double) -&gt; Vector Double)
-&gt; (Vector Double, Matrix Double) -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FittingMethod
-&gt; Double
-&gt; Double
-&gt; Int
-&gt; (Vector Double -&gt; Vector Double)
-&gt; (Vector Double -&gt; Matrix Double)
-&gt; Vector Double
-&gt; (Vector Double, Matrix Double)
</span><span class="hs-identifier hs-var">nlFitting</span></span><span> </span><span class="annot"><span class="annottext">FittingMethod
</span><span class="hs-identifier hs-var">LevenbergMarquardtScaled</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-6</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1e-6</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679075319"><span class="hs-identifier hs-var">niter</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075311"><span class="hs-identifier hs-var">model'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Matrix Double
</span><a href="#local-6989586621679075310"><span class="hs-identifier hs-var">jacob'</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075313"><span class="hs-identifier hs-var">theta0</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621679075311"><span class="annot"><span class="annottext">model' :: Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075311"><span class="hs-identifier hs-var hs-var">model'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#model"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075315"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075316"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075318"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075317"><span class="hs-identifier hs-var">zssQ</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span id="local-6989586621679075310"><span class="annot"><span class="annottext">jacob' :: Vector Double -&gt; Matrix Double
</span><a href="#local-6989586621679075310"><span class="hs-identifier hs-var hs-var">jacob'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double)
-&gt; Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#jacob"><span class="hs-identifier hs-var">jacob</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075314"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075318"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075317"><span class="hs-identifier hs-var">zssQ</span></a></span><span>    </span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- | calculates the error given the parameter vector beta</span><span>
</span><span id="line-191"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#model"><span class="hs-identifier hs-type">model</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-192"></span><span id="model"><span class="annot"><span class="annottext">model :: (Vector Double -&gt; Vector Double)
-&gt; Vector Double
-&gt; Matrix Double
-&gt; Matrix Double
-&gt; Vector Double
-&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#model"><span class="hs-identifier hs-var hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679075307"><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075307"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679075306"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075306"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span id="local-6989586621679075305"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075305"><span class="hs-identifier hs-var">zssP</span></a></span></span><span> </span><span id="local-6989586621679075304"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075304"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span> </span><span id="local-6989586621679075303"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075303"><span class="hs-identifier hs-var">beta</span></a></span></span><span> </span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075304"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075307"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075302"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075306"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075307"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075301"><span class="hs-identifier hs-var">ysHat</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075306"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075299"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075299"><span class="hs-identifier hs-var">betaP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075298"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075298"><span class="hs-identifier hs-var">betaQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double -&gt; (Vector Double, Vector Double)
forall a. Storable a =&gt; Int -&gt; Vector a -&gt; (Vector a, Vector a)
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075305"><span class="hs-identifier hs-var">zssP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075303"><span class="hs-identifier hs-var">beta</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679075302"><span class="annot"><span class="annottext">ysHat_P :: Vector Double
</span><a href="#local-6989586621679075302"><span class="hs-identifier hs-var hs-var">ysHat_P</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075305"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075299"><span class="hs-identifier hs-var">betaP</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679075294"><span class="annot"><span class="annottext">ysHat_Q :: Vector Double
</span><a href="#local-6989586621679075294"><span class="hs-identifier hs-var hs-var">ysHat_Q</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075304"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075304"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075298"><span class="hs-identifier hs-var">betaQ</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679075301"><span class="annot"><span class="annottext">ysHat :: Vector Double
</span><a href="#local-6989586621679075301"><span class="hs-identifier hs-var hs-var">ysHat</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075302"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075294"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- | calculates the Jacobian given the parameter vector beta. Doesn't support</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- the outer transformation function.</span><span>
</span><span id="line-203"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#jacob"><span class="hs-identifier hs-type">jacob</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Vector</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Matrix</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-204"></span><span id="jacob"><span class="annot"><span class="annottext">jacob :: (Vector Double -&gt; Vector Double)
-&gt; Matrix Double -&gt; Matrix Double -&gt; Vector Double -&gt; Matrix Double
</span><a href="MachineLearning.Model.Regression.html#jacob"><span class="hs-identifier hs-var hs-var">jacob</span></a></span></span><span> </span><span id="local-6989586621679075287"><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075287"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679075286"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075286"><span class="hs-identifier hs-var">zssP</span></a></span></span><span> </span><span id="local-6989586621679075285"><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075285"><span class="hs-identifier hs-var">zssQ</span></a></span></span><span> </span><span id="local-6989586621679075284"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075284"><span class="hs-identifier hs-var">beta</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075285"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075286"><span class="hs-identifier hs-var">zssP</span></a></span><span>
</span><span id="line-205"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; Matrix Double
forall t. Element t =&gt; [Vector t] -&gt; Matrix t
</span><span class="hs-identifier hs-var">LA.fromColumns</span></span><span> </span><span class="annot"><span class="annottext">([Vector Double] -&gt; Matrix Double)
-&gt; [Vector Double] -&gt; Matrix Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075283"><span class="hs-identifier hs-var">pjac</span></a></span><span> </span><span class="annot"><span class="annottext">[Vector Double] -&gt; [Vector Double] -&gt; [Vector Double]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Vector Double]
</span><a href="#local-6989586621679075282"><span class="hs-identifier hs-var">qjac</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679075280"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075280"><span class="hs-identifier hs-var">betaP</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679075279"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075279"><span class="hs-identifier hs-var">betaQ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Vector Double -&gt; (Vector Double, Vector Double)
forall a. Storable a =&gt; Int -&gt; Vector a -&gt; (Vector a, Vector a)
</span><span class="hs-identifier hs-var">splitAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Matrix Double -&gt; Int
forall t. Matrix t -&gt; Int
</span><span class="hs-identifier hs-var">LA.cols</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075286"><span class="hs-identifier hs-var">zssP</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075284"><span class="hs-identifier hs-var">beta</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679075278"><span class="annot"><span class="annottext">ysHat_P :: Vector Double
</span><a href="#local-6989586621679075278"><span class="hs-identifier hs-var hs-var">ysHat_P</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075286"><span class="hs-identifier hs-var">zssP</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075280"><span class="hs-identifier hs-var">betaP</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621679075277"><span class="annot"><span class="annottext">ysHat_Q :: Vector Double
</span><a href="#local-6989586621679075277"><span class="hs-identifier hs-var hs-var">ysHat_Q</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; Vector Double -&gt; Vector Double
</span><a href="MachineLearning.Model.Regression.html#predict"><span class="hs-identifier hs-var">predict</span></a></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075285"><span class="hs-identifier hs-var">zssQ</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075279"><span class="hs-identifier hs-var">betaQ</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span id="local-6989586621679075270"><span class="annot"><span class="annottext">ysHat :: Vector Double
</span><a href="#local-6989586621679075270"><span class="hs-identifier hs-var hs-var">ysHat</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double
</span><a href="#local-6989586621679075287"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Vector Double -&gt; Vector Double) -&gt; Vector Double -&gt; Vector Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075278"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075277"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679075283"><span class="annot"><span class="annottext">pjac :: [Vector Double]
</span><a href="#local-6989586621679075283"><span class="hs-identifier hs-var hs-var">pjac</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075270"><span class="hs-identifier hs-var">ysHat</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075263"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075277"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679075263"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075263"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toColumns</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075286"><span class="hs-identifier hs-var">zssP</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679075282"><span class="annot"><span class="annottext">qjac :: [Vector Double]
</span><a href="#local-6989586621679075282"><span class="hs-identifier hs-var hs-var">qjac</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075270"><span class="hs-identifier hs-var">ysHat</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075248"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075278"><span class="hs-identifier hs-var">ysHat_P</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Vector Double -&gt; Vector Double -&gt; Vector Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075277"><span class="hs-identifier hs-var">ysHat_Q</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Vector Double -&gt; Integer -&gt; Vector Double
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679075248"><span class="annot"><span class="annottext">Vector Double
</span><a href="#local-6989586621679075248"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Matrix Double -&gt; [Vector Double]
forall t. Element t =&gt; Matrix t -&gt; [Vector t]
</span><span class="hs-identifier hs-var">LA.toColumns</span></span><span> </span><span class="annot"><span class="annottext">Matrix Double
</span><a href="#local-6989586621679075285"><span class="hs-identifier hs-var">zssQ</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span id="local-6989586621679075686"><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-type">derivative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679075686"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Floating</span></span><span> </span><span class="annot"><a href="#local-6989586621679075686"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Function</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075686"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679075686"><span class="hs-identifier hs-type">val</span></a></span></span><span>
</span><span id="line-215"></span><span id="derivative"><span class="annot"><span class="annottext">derivative :: forall val. (Eq val, Floating val) =&gt; Function -&gt; val -&gt; val
</span><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var hs-var">derivative</span></a></span></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Id</span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span>
</span><span id="line-216"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Abs</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679075171"><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621679075171"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621679075171"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621679075171"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-217"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Sin</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cos</span></span><span>
</span><span id="line-218"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Cos</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sin</span></span><span>
</span><span id="line-219"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Tan</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">**</span></span><span class="annot"><span class="annottext">val
</span><span class="hs-number">2.0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cos</span></span><span>
</span><span id="line-220"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Sinh</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">cosh</span></span><span>
</span><span id="line-221"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Cosh</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sinh</span></span><span>
</span><span id="line-222"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Tanh</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">**</span></span><span class="annot"><span class="annottext">val
</span><span class="hs-number">2.0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">tanh</span></span><span>
</span><span id="line-223"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">ASin</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; Integer -&gt; val
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">ACos</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; Integer -&gt; val
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">ATan</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; Integer -&gt; val
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">ASinh</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; Integer -&gt; val
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">ACosh</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679075150"><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621679075150"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">ATanh</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val -&gt; Integer -&gt; val
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Sqrt</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(val -&gt; val) -&gt; (val -&gt; val) -&gt; val -&gt; val
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">sqrt</span></span><span>
</span><span id="line-230"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Square</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">val -&gt; val -&gt; val
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Exp</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Floating a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">exp</span></span><span>
</span><span id="line-232"></span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-identifier hs-var">derivative</span></a></span><span> </span><span class="annot"><span class="annottext">Function
</span><span class="hs-identifier hs-var">Log</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">val -&gt; val
forall a. Fractional a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">recip</span></span><span>
</span><span id="line-233"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="MachineLearning.Model.Regression.html#derivative"><span class="hs-pragma hs-type">derivative</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- (w1 * p1 + w2 * p2) / (1 + w3 * p3 + w4 * p4)</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- d/dw1 = p1 / (1 + w3 * p3 + w4 * p4)</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- d/dw2 = p2 / (1 + w3 * p3 + w4 * p4)</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- d/dw3 = -p3 * (w1 * p2 + w2 * p2) / (1 + w3 * p3 + w4 * p4)^2</span><span>
</span><span id="line-238"></span><span class="hs-comment">{-
toEv :: SRTree Int Double -&gt; (V.Vector Double -&gt; Double)
toEv (Var !ix) = (`V.unsafeIndex` ix)
toEv (Const !val) = const val
toEv (Add !l !r) = jn (+) (toEv l) (toEv r)
toEv (Mul !l !r) = jn (*) (toEv l) (toEv r)
toEv (Fun Exp !t) = exp . toEv t
{-# INLINE toEv #-}

jn :: (Double -&gt; Double -&gt; Double) -&gt; (V.Vector Double -&gt; Double) -&gt; (V.Vector Double -&gt; Double) -&gt; (V.Vector Double -&gt; Double)
jn op f g = \x -&gt; op (f x) (g x)
{-# INLINE jn #-}
-}</span><span>
</span><span id="line-251"></span></pre></body></html>